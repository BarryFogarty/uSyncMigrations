@inherits Umbraco.Web.Mvc.UmbracoViewPage<ContentModels.MemberChangePassword>
@using ContentModels = Umbraco.Web.PublishedModels;
@using QMUCloud.Core.Models.ViewModels
@using QMUCloud.Core.Controllers

@{
    Layout = "Master.cshtml";
    var formModel = new ChangePasswordModel();
}

@section ExtraCss
{
    @* Put this in the header to stop the page being indexed by search engines *@
    <meta name="robots" content="noindex, nofollow">
}

@Html.CachedPartial("bannerItem", Model, QMUCloud.Core.QMUConstants.PartialCachedSeconds, true)

<main role="main" class="main-content">

    <div class="container member-form change-password-form">
        <div class="column-layout">

            <div class="left" id="left" tabindex="-1">

                @Html.CachedPartial("breadcrumb", Model, QMUCloud.Core.QMUConstants.PartialCachedSeconds, true)
                <h1>@Model.DisplayTitle</h1>

                @if (TempData["CustomMessage"] == "Updated")
                {
                    var now = DateTime.Now;
                    <p>Password updated on @now.ToString("dd/MM/yy") at @now.ToString("HH:mm:ss")</p>
                }

                @using (Html.BeginUmbracoForm<ApprovalChangePasswordController>("ChangePassword"))
                {
                    @Html.AntiForgeryToken()

                    <fieldset>
                        <legend>Change Password</legend>

                        @if (TempData["CustomMessage"] == "NoMatch")
                        {
                            <div class="validation-summary-errors">
                                <ul>
                                    <li>The passwords do not match. Please try again.</li>
                                </ul>
                            </div>
                        }
                        else if (TempData["CustomMessage"] == "Failure")
                        {
                            <div class="validation-summary-errors">
                                <ul>
                                    <li>Error updating password, please check old password. Please try again.</li>
                                </ul>
                            </div>
                        }
                        @Html.ValidationSummary()

                        @Html.LabelFor(m => formModel.OldPassword)
                        @Html.PasswordFor(m => formModel.OldPassword)
                        <br />

                        @Html.LabelFor(m => formModel.NewPassword)
                        @Html.PasswordFor(m => formModel.NewPassword)
                        <br />

                        @Html.LabelFor(m => formModel.RepeatPassword)
                        @Html.PasswordFor(m => formModel.RepeatPassword)
                        <br />

                        <button>Change Password</button>
                    </fieldset>
                }

            </div>

        </div>
    </div>

    @* Pulls through lower banner partial if there is an image *@
    @if (Model.HasValue("lowerBannerImage"))
    {
        var lbModel = new QMU_VM_LowerBannerModel
        {
            Title = Model.LowerBannerTitle,
            Copy = Model.LowerBannerCopy.ToString(),
            BannerImage = Model.LowerBannerImage,
            MobileBannerImage = Model.LowerBannerImageMobile,
            BoxPosition = Model.HorizontalAdPlacement,
            IsInfographic = Model.UsingBannerForInfographic
        };

        @Html.CachedPartial("components/qmu_cmp_lowerBanner", lbModel, QMUCloud.Core.QMUConstants.PartialCachedSeconds, true)
    }

</main>
