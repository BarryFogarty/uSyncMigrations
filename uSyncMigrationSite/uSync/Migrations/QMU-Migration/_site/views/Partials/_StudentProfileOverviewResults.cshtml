@inherits Umbraco.Web.Mvc.UmbracoViewPage<QMUCloud.Core.Models.ViewModels.QMU_VM_StudentProfilesOverviewResults>
@using System.Text.RegularExpressions
@using QMUCloud.Core.Helpers

@{
    bool showPagination = Model.TotalResultsCount > Model.MaxResultsPerPage;
    bool showSelectedFilters = !String.IsNullOrEmpty(Model.TypeFilter) || !String.IsNullOrEmpty(Model.CourseFilter) || !String.IsNullOrEmpty(Model.CountryFilter) || !String.IsNullOrEmpty(Model.ThemeFilter);
    bool showSearchMeta = showPagination || showSelectedFilters;
}


@if (showSearchMeta == true)
{
    <div class="student-prof-result__meta">

        @if (showSelectedFilters == true)
        {

            <div class="student-prof-result__meta__upper">
                <p>
                    Showing results for:
                    @if (!String.IsNullOrEmpty(Model.TypeFilter))
                    {
                        <span class="filter-tag">@Model.TypeFilter</span>
                    }
                    @if (!String.IsNullOrEmpty(Model.CourseFilter))
                    {
                        <span class="filter-tag">@Model.CourseFilter</span>
                    }
                    @if (!String.IsNullOrEmpty(Model.CountryFilter))
                    {
                        <span class="filter-tag">@Model.CountryFilter</span>
                    }
                    @if (!String.IsNullOrEmpty(Model.ThemeFilter))
                    {
                        <span class="filter-tag">@Model.ThemeFilter</span>
                    }
                </p>
            </div>
        }

        <div class="student-prof-result__meta__lower">

            @if (showPagination == true)
            {
                <div class="student-prof-result__meta__lower__pagi">
                    @Html.Partial("PageStructure/QMU_PRT_Pagination", Model)
                </div>
            }

            @* Show a page count if more than one page *@
            @if(Model.TotalResultsCount > Model.MaxResultsPerPage)
            {
                var ifSingleResult = Model.TotalResultsCount;
                var fromCount = (Model.MaxResultsPerPage * (Model.CurrentPage + 1)) - (Model.Results.Count() - 1);
                var toCount = Model.MaxResultsPerPage * (Model.CurrentPage + 1);
                var totalCount = Model.TotalResultsCount;

                    <div class="student-prof-result__meta__lower__count">
                        <span> @($"Showing {(Model.Results.Count() == 1 ? $"{ifSingleResult}" : $"{fromCount} to {toCount}")} of {totalCount}")</span>
                    </div>
                }
        </div>
       
    </div>
}

@if (Model.TotalResultsCount == 0)
{
    <div class="text-center pt-5 pt-md-0" role="alert">
        <p>
            Sorry, there were no items that matched your filter criteria. You can <button class="js--clear-filters" tabindex="0">clear the filters</button> to search again.
        </p>
    </div>
}

@if (Model.TotalResultsCount > 0)
{



    <div class="filter-grid no-padding-grid row  @(showSearchMeta == false ? "pt-5 mt-5" : "")">

        @foreach (Profile studentProfile in Model.Results)
        {
            CountryTag countryProfile = studentProfile.Country != null ? studentProfile.Country as CountryTag : null;
            CourseTag courseProfile = studentProfile.Course != null ? studentProfile.Course as CourseTag : null;

            if (studentProfile.Country != null)
            {
                countryProfile = studentProfile.Country as CountryTag;
            }


            <div class="filter-item col-sm-6 col-lg-4 mb-4">

                <a href="@studentProfile.Url()" 
                   title="Go to student profile for @studentProfile.Name"
                   aria-label="Go to student profile for @studentProfile.Name"
                   class="box w-100 d-block">
                        <div class="image mb-0">
                            @if (studentProfile.AdSpotImage != null)
                            {
                                @Html.WebpImg(studentProfile.AdSpotImage, studentProfile.DisplayTitle)
                            }
                            <div class="overlay-text lh-sm">


                                @if(!String.IsNullOrEmpty(studentProfile.DisplayTitle) || countryProfile != null)
                                {
                                    <div class="d-flex @(courseProfile != null ? "mb-1" : "")">
                                        @if (!String.IsNullOrEmpty(studentProfile.DisplayTitle))
                                        {
                                            <span>
                                                @studentProfile.DisplayTitle
                                            </span>
                                        }

                                        @if (countryProfile != null)
                                        {
                                            <div class="d-flex align-items-center ms-auto">
                                                @if (countryProfile.CountryFlag != null)
                                                {
                                                var image = countryProfile.CountryFlag as Image;
                                                <span class="flag-icon me-1">
                                                    <img src="@image.Url()" alt="@image.AltText" loading="lazy" />
                                                </span>
                                                }

                                                @if (!String.IsNullOrEmpty(countryProfile.Country))
                                                {
                                                <small style="font-size:14px;vertical-align:middle;">@countryProfile.Country</small>
                                                }
                                            </div>
                                          
                                        }
                                    </div>
                                }
                                @if(courseProfile != null && !String.IsNullOrEmpty(courseProfile?.CourseName) && courseProfile?.QualificationType != null)
                                {
                                    string courseName = courseProfile.CourseName;
                                    string courseType = string.Join("/", courseProfile.QualificationType);

                                    <p style="font-size:14px; line-height: 16px;" class="title text-small mb-0">@courseType @courseName</p>
                                }
                            </div>
                        </div>
                </a>
            </div>
        }
    </div>

    if (showPagination == true)
    {
        @Html.Partial("PageStructure/QMU_PRT_Pagination", Model)
    }
}

<style>


    .image div a img {
        min-width: 361px;
        min-height: 214px;
        outline: 1px solid red;
    }
</style>